# N E X T F L O W
##########################################################################
#####   SAMPLE RIBOFLOW ARGUMENTS FILE WITH RNASEQ AND METADATA   ########
##########################################################################

# Tested on  version 19.04.1

# Perform fastqc at several stages of the pipeline
do_fastqc: false

# Check existnece of fastq.gz files and bowtie2 reference files
do_check_file_existence : true

# Deduplication method: "umi_tools", "position", or "none"
# - "umi_tools": UMI-based deduplication (requires UMI extraction)
# - "position": Position-based deduplication (removes duplicate coordinates)
# - "none": No deduplication performed
dedup_method: "umi_tools"

# UMI extraction pattern - adjust based on your library preparation
umi_tools_extract_arguments: "-p \"^(?P<umi_1>.{12})(?P<discard_1>.{4}).+$\" --extract-method=regex"
# UMI deduplication arguments
umi_tools_dedup_arguments:   "--read-length"

# Enable RNA-seq processing (set to true if you have RNA-seq data)
do_rnaseq: false

# Set to false for genome alignment mode
do_ribo_creation: false

do_metadata: true

clip_arguments: ' -a AAAAAAAAAACAAAAAAAAAA --overlap=4 --trimmed-only --maximum-length=56 --minimum-length=31 --quality-cutoff=28'
mapping_quality_cutoff: 60

###############################################################################

alignment_arguments:
   filter:        '-L 15 --no-unal --norc'
   genome: '--no-unal -k 5 --no-softclip --no-spliced-alignment --known-splicesite-infile ./rf_sample_data/genome/hisat2_spliced_index_splice_sites.txt'

###############################################################################

ribo:
    ref_name:        "appris-v1"
    metagene_radius: 50
    left_span:       35
    right_span:      10
    read_length:
       min: 21
       max: 40
    coverage: true

###############################################################################
# Output folder settings
output:
   individual_lane_directory: 'individual'
   merged_lane_directory: 'merged'
   intermediates:
      base: 'intermediates_umi'
      clip: 'clip'
      log: 'log'
      transcriptome_alignment: 'transcriptome_alignment'
      filter: 'filter'
      genome_alignment: 'genome_alignment'
      bam_to_bed: 'bam_to_bed'
      quality_filter: 'quality_filter'
      alignment_ribo: 'alignment_ribo' # bigwigs are stored in here.
      bigwigs: 'bigwigs'
   output:
      base: 'output_umi'
      log: 'log'
      fastqc: 'fastqc'
      ribo: 'ribo'

###############################################################################

input:
   reference:
      filter: ./rf_sample_data/filter/human_rtRNA*
      regions: ./rf_sample_data/annotation/appris_human_24_01_2019_actual_regions.bed
      transcript_lengths: ./rf_sample_data/annotation/appris_human_24_01_2019_selected.lengths.tsv
      genome: ./rf_sample_data/genome/hisat2_spliced_index*
      # BED12 file for strand detection (required if using automatic strandedness detection)
      ref_bed: ./rf_sample_data/annotation/hg38_GENCODE_V47.bed.gz

   fastq_base: ""
   fastq:
       # We have two ribosome profiling experiments called 
       # 1cell-2 and 1cell-4
       1cell-2:
         - ./rf_sample_data/fastq/ribosome_profiling/1cell-2/1cell-2.fastq.gz

       1cell-4:
         - ./rf_sample_data/fastq/ribosome_profiling/1cell-4/1cell-4.fastq.gz


   root_meta: "./project_umi.yaml"

###############################################################################
# P-site Offset Correction (Optional)
# Uncomment and configure if you want P-site correction for ribo-seq data
# P-site correction converts reads to 1bp at the ribosome P-site position
# 
# Requirements:
# - CSV file with experiment-specific P-site offsets per read length
# - Map each sample and lane to an experiment ID from the offset file
# 
# Note: BigWig generation does not require p-site correction


# psite_offset:
#   offset_file: "./outputHuman_OFFSETS.csv"
#   sample_matching:
#     experiment_1:  # Your sample name
#       lanes:
#         1: "GSM4114767"  # Experiment ID from offset CSV
#         2: "GSM4114768"


###############################################################################
# RNA-seq Configuration

# Key settings:
# - dedup_method: "position" (recommended) or "none"
# - library_strandedness: "reverse" (default, most common) or "forward"
#
# - genome_read_trim: Optional read trimming before genome alignment
#   Set enabled: true and specify length to trim reads after rRNA filtering
#
# Note: RNA-seq bigWigs are automatically generated in:
#       intermediates_*/rnaseq/alignment_ribo/bigwigs/merged/

# rnaseq:
#   clip_arguments: '-u 1 --quality-cutoff=28'
#   dedup_method: "position"
#   fastq_base: ""
#   library_strandedness: "auto"  # "forward", "reverse", or "auto"
#   filter_arguments: '-L 20 --no-unal'
#   hisat2_arguments: "--no-unal -k 1 --no-softclip --known-splicesite-infile ./rf_sample_data/genome/hisat2_spliced_index_splice_sites.txt"
#   genome_read_trim:  # Optional: trim reads after filtering
#     enabled: true
#     length: 30
#   fastq:
#       experiment_1:
#       - ../samples/fastq_downloads_umi/SRR10251291.fastq.gz
#       - ../samples/fastq_downloads_umi/SRR10251292.fastq.gz
